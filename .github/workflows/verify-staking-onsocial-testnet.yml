name: Staking Testnet Deploy

on:
  push:
    paths:
      - '.github/workflows/verify-staking-onsocial-testnet.yml'
  schedule:
    - cron: '0 */6 * * *' # Every 6 hours
  workflow_dispatch:

jobs:
  verify:
    name: Verify Deployment
    runs-on: ubuntu-latest
    steps:
      - name: Check contract on testnet
        run: |
          RESPONSE=$(curl -s -X POST https://neart.lava.build \
            -H "Content-Type: application/json" \
            -d '{
              "jsonrpc": "2.0",
              "id": "1",
              "method": "query",
              "params": {
                "request_type": "view_account",
                "finality": "final",
                "account_id": "staking.onsocial.testnet"
              }
            }')
          
          echo "Response: $RESPONSE"
          
          CODE_HASH=$(echo "$RESPONSE" | jq -r '.result.code_hash // empty')
          
          if [ -z "$CODE_HASH" ]; then
            echo "❌ Contract not found on testnet"
            exit 1
          fi
          
          if [ "$CODE_HASH" = "11111111111111111111111111111111" ]; then
            echo "❌ No code deployed to contract"
            exit 1
          fi
          
          echo "✅ Staking contract deployed on testnet"
          echo "Code hash: $CODE_HASH"
