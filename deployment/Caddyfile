# OnSocial Production Caddyfile
# Auto-TLS via Let's Encrypt for all domains
#
# DNS records required (A records → your Hetzner IP):
#   api.onsocial.id
#   hasura.onsocial.id
#   relay.onsocial.id

# ---------- API Gateway ----------
api.onsocial.id {
	reverse_proxy gateway:8080

	# Security headers
	header {
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	# Request size limit (10MB — for Lighthouse uploads)
	request_body {
		max_size 10MB
	}

	log {
		output file /data/logs/gateway.log {
			roll_size 50MB
			roll_keep 5
		}
	}
}

# ---------- Hasura GraphQL ----------
hasura.onsocial.id {
	reverse_proxy hasura:8080

	header {
		X-Content-Type-Options "nosniff"
		-Server
	}

	log {
		output file /data/logs/hasura.log {
			roll_size 50MB
			roll_keep 5
		}
	}
}

# ---------- Relayer ----------
relay.onsocial.id {
	reverse_proxy relayer:3040

	header {
		X-Content-Type-Options "nosniff"
		X-Frame-Options "DENY"
		-Server
	}

	# Relayer requests are small
	request_body {
		max_size 1MB
	}

	log {
		output file /data/logs/relayer.log {
			roll_size 50MB
			roll_keep 5
		}
	}
}
