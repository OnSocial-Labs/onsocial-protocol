specVersion: v0.1.0
package:
  name: onsocial_events
  version: v0.6.0
  url: https://github.com/onsocial-protocol/indexers/substreams
  description: High-performance substreams indexer for OnSocial protocol events
  doc: |
    OnSocial NEAR Contract Event Indexer
    Decodes NEP-297 JSON events from core-onsocial contract logs
    Outputs to PostgreSQL via substreams-sink-sql

network: near

binaries:
  default:
    type: wasm/rust-v1
    file: ./target/wasm32-unknown-unknown/release/onsocial_substreams.wasm

protobuf:
  files:
    - onsocial.proto
    - sf/substreams/sink/database/v1/database.proto
    - sf/substreams/sink/sql/v1/service.proto
  importPaths:
    - ./proto

modules:
  # Primary module - typed output
  - name: map_onsocial_output
    kind: map
    inputs:
      - params: string
      - source: sf.near.type.v1.Block
    output:
      type: proto:onsocial.v1.Output
    doc: |
      Extracts OnSocial events and outputs typed protobuf messages.
      
      Output contains:
      - data_updates: Posts, profiles, settings, group content
      - storage_updates: Deposits, withdrawals, pool operations
      - group_updates: Membership, governance, proposals
      - contract_updates: Meta transactions
      - permission_updates: Access control changes

  # Database changes output - for substreams-sink-sql (PostgreSQL)
  - name: db_out
    kind: map
    inputs:
      - map: map_onsocial_output
    output:
      type: proto:sf.substreams.sink.database.v1.DatabaseChanges
    doc: |
      Converts typed Output to DatabaseChanges for SQL sink.
      Use this module with substreams-sink-sql for PostgreSQL indexing.

params:
  map_onsocial_output: "contract_id=core.onsocial.testnet"

sink:
  module: db_out
  type: sf.substreams.sink.sql.v1.Service
  config:
    schema: "./schema.sql"
